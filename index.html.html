<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏™‡∏±‡πà‡∏á‡∏Å‡∏£‡∏µ‡∏Å‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï üç®</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  body {
    font-family: 'IBM Plex Sans Thai', sans-serif;
    background: #e9f4ff;
    padding: 20px;
  }
  .box {
    max-width: 450px;
    margin: auto;
    background: white;
    padding: 22px;
    border-radius: 20px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.12);
  }
  h2 {
    text-align: center;
    margin-bottom: 18px;
  }
  select, input {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid #aacbff;
  }
  button {
    width: 100%;
    background: #4d9bff;
    color: white;
    padding: 18px;
    font-size: 18px;
    border: 0;
    border-radius: 14px;
    cursor: pointer;
    margin-top: 20px;
  }
  .price-box {
    margin-top: 15px;
    background: #f0f7ff;
    padding: 12px;
    border-radius: 12px;
    text-align: center;
    font-size: 18px;
  }
  .stock {
    text-align: center;
    background: #d9edff;
    padding: 10px;
    border-radius: 20px;
    font-size: 16px;
    margin-bottom: 15px;
  }
  .fruits {
    margin-top: 10px;
    padding: 10px;
    background: #f7fbff;
    border-radius: 10px;
  }
  .fruits label {
    display: block;
    padding: 5px 0;
  }
</style>
</head>

<body>

<div class="box">

  <div class="stock">
    üì¶ ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <span id="stockText">‡πÇ‡∏´‡∏•‡∏î...</span> / 32 ‡∏™‡∏Å‡∏π‡πä‡∏õ
  </div>

  <h2>üç® ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏£‡∏µ‡∏Å‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï</h2>

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏Å‡∏π‡πä‡∏õ</label>
  <select id="scoops" onchange="updatePrice()">
    <option value="1">1 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
    <option value="2">2 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
  </select>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏≠‡∏¢‡πà‡∏≤‡∏á)</label>

  <div class="fruits">
    <label><input type="checkbox" name="fruit" value="‡∏Å‡∏µ‡∏ß‡∏µ"      onchange="limitFruit()"> ‡∏Å‡∏µ‡∏ß‡∏µ</label>
    <label><input type="checkbox" name="fruit" value="‡∏Å‡∏•‡πâ‡∏ß‡∏¢"     onchange="limitFruit()"> ‡∏Å‡∏•‡πâ‡∏ß‡∏¢</label>
    <label><input type="checkbox" name="fruit" value="‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" onchange="limitFruit()"> ‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà</label>
    <label><input type="checkbox" name="fruit" value="‡∏≠‡∏á‡∏∏‡πà‡∏ô"      onchange="limitFruit()"> ‡∏≠‡∏á‡∏∏‡πà‡∏ô</label>
    <label><input type="checkbox" name="fruit" value="‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á" onchange="limitFruit()"> ‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á</label>
    <label><input type="checkbox" name="fruit" value="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á" onchange="limitFruit()"> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á</label>
    <label><input type="checkbox" name="fruit" value="‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á" onchange="limitFruit()"> ‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á</label>
  </div>

  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">

  <div class="price-box">
    üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: <span id="priceText">0</span> ‡∏ö‡∏≤‡∏ó
  </div>

  <button onclick="submitOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>

</div>

<script>
  const endpoint = "https://script.google.com/macros/s/AKfycbx0eur7Ev9lwX1RzF_OHI_3Ui5W01B1d8Knzad37DmSiQ8GoI0PcMq3UF1cyGJM8gfD/exec";   // ‚Üê ‡πÄ‡∏õ‡∏£‡∏°‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

  const prices = {
    "1_none": 39,
    "2_none": 69,
    "1_fruit": 59,
    "2_fruit": 89
  };

  let currentStock = 0;

  async function loadStock() {
    const res = await fetch(endpoint + "?stock=true");
    const data = await res.json();
    currentStock = data.stock;
    document.getElementById("stockText").innerText = currentStock;
  }

  // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏≠‡∏¢‡πà‡∏≤‡∏á
  function limitFruit() {
    const boxes = document.querySelectorAll("input[name='fruit']:checked");
    if (boxes.length > 3) {
      Swal.fire("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üçì");
      event.target.checked = false;
    }
    updatePrice();
  }

  function updatePrice() {
    const scoops = document.getElementById("scoops").value;
    const selected = document.querySelectorAll("input[name='fruit']:checked");
    const fruitCount = selected.length;

    const key = scoops + "_" + (fruitCount === 0 ? "none" : "fruit");
    document.getElementById("priceText").innerText = prices[key];
  }

  async function submitOrder() {
    const scoops = Number(document.getElementById("scoops").value);
    const name = document.getElementById("name").value.trim();

    const fruitBoxes = document.querySelectorAll("input[name='fruit']:checked");
    const fruits = Array.from(fruitBoxes).map(f => f.value);

    const price = Number(document.getElementById("priceText").innerText);

    if (!name) {
      Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
      return;
    }

    if (scoops > currentStock) {
      Swal.fire("‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö ü•∫");
      return;
    }

    const data = {
      name,
      scoops,
      fruits,
      price,
      timestamp: new Date().toLocaleString("th-TH")
    };

    await fetch(endpoint, {
      method: "POST",
      body: JSON.stringify(data)
    });

    Swal.fire({
      icon: "success",
      title: "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
      text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö üç®",
    });

    loadStock();
    document.getElementById("name").value = "";
    fruitBoxes.forEach(f => f.checked = false);
    updatePrice();
  }

  loadStock();
  updatePrice();
</script>

</body>
</html>
