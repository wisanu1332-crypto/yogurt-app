<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡∏™‡∏±‡πà‡∏á‡∏Å‡∏£‡∏µ‡∏Å‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï ü•£</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  :root{
    --bg:#e9f4ff;
    --card:#ffffff;
    --primary:#2f8cff;
    --primary2:#1b6fe0;
    --border:#aacbff;
    --muted:#f0f7ff;
    --text:#0b1b33;
  }
  body{
    font-family:'IBM Plex Sans Thai',sans-serif;
    background:var(--bg);
    padding:20px;
    color:var(--text);
  }
  .box{
    max-width:460px;
    margin:auto;
    background:var(--card);
    padding:22px;
    border-radius:22px;
    box-shadow:0 4px 18px rgba(0,0,0,.12);
  }
  h2{ text-align:center; margin:4px 0 16px; }
  .badge{
    text-align:center;
    background:#d9edff;
    padding:10px 12px;
    border-radius:999px;
    font-size:15px;
    margin-bottom:14px;
  }
  label{ display:block; margin-top:12px; font-weight:500; }
  select,input{
    width:100%;
    padding:14px;
    margin-top:8px;
    font-size:16px;
    border-radius:12px;
    border:1px solid var(--border);
    outline:none;
  }
  select:focus,input:focus{ border-color:var(--primary); }
  .price{
    margin-top:14px;
    background:var(--muted);
    padding:12px 14px;
    border-radius:14px;
    text-align:center;
    font-size:18px;
  }
  button{
    width:100%;
    background:var(--primary);
    color:white;
    padding:18px;
    font-size:18px;
    border:0;
    border-radius:16px;
    cursor:pointer;
    margin-top:18px;
  }
  button:hover{ background:var(--primary2); }
  button:disabled{
    background:#9bc7ff;
    cursor:not-allowed;
  }
  .small{
    font-size:13px;
    opacity:.75;
    margin-top:10px;
    text-align:center;
  }
</style>
</head>

<body>
  <div class="box">
    <div class="badge" id="statusBadge">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...</div>

    <h2>ü•£ ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏£‡∏µ‡∏Å‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï</h2>

    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
    <input id="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" />

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏Å‡∏π‡πä‡∏õ</label>
    <select id="scoops">
      <option value="1">1 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
      <option value="2">2 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
      <option value="3">3 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
      <option value="4">4 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
      <option value="5">5 ‡∏™‡∏Å‡∏π‡πä‡∏õ</option>
    </select>

    <div class="price">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: <span id="priceText">0</span> ‡∏ö‡∏≤‡∏ó</div>

    <button id="orderBtn" onclick="submitOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>

    <div class="small">*‡∏´‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
  </div>

<script>
  // ‚úÖ ‡πÉ‡∏™‡πà Web App URL ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const endpoint = "https://script.google.com/macros/s/AKfycbzoF7m6vUXpoCkp-XglWiTUA8CtRWWaDRiHRLK_SUBLiFtxHlAe4NWKglO5U02yUdoL/exec";

  const priceMap = { 1:40, 2:75, 3:115, 4:155, 5:195 };

  const nameEl = document.getElementById("name");
  const scoopsEl = document.getElementById("scoops");
  const priceEl = document.getElementById("priceText");
  const badgeEl = document.getElementById("statusBadge");
  const btnEl = document.getElementById("orderBtn");

  function updatePrice(){
    const scoops = Number(scoopsEl.value);
    priceEl.innerText = priceMap[scoops] ?? 0;
  }

  async function loadStatus(){
    try{
      const res = await fetch(endpoint + "?status=true", { method:"GET" });
      const data = await res.json();

      if (data && data.open === true){
        badgeEl.innerText = "‚úÖ ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏≠‡∏¢‡∏π‡πà";
        badgeEl.style.background = "#d9ffe6";
        btnEl.disabled = false;
      } else {
        badgeEl.innerText = "‚õî ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß";
        badgeEl.style.background = "#ffe1e1";
        btnEl.disabled = true;
      }
    } catch (e){
      badgeEl.innerText = "‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô)";
      badgeEl.style.background = "#fff1d6";
      btnEl.disabled = true;
    }
  }

  async function submitOrder(){
    const name = nameEl.value.trim();
    const scoops = Number(scoopsEl.value);
    const price = priceMap[scoops] ?? 0;

    if(!name){
      Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö");
      return;
    }

    const confirm = await Swal.fire({
      title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠?",
      html: `‡∏ä‡∏∑‡πà‡∏≠: <b>${name}</b><br/>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <b>${scoops}</b> ‡∏™‡∏Å‡∏π‡πä‡∏õ<br/>‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${price}</b> ‡∏ö‡∏≤‡∏ó`,
      icon: "question",
      showCancelButton: true,
      confirmButtonText: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
      cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    });

    if(!confirm.isConfirmed) return;

    btnEl.disabled = true;

    try{
      const payload = {
        name,
        scoops,
        price,
        timestamp: new Date().toLocaleString("th-TH")
      };

      await fetch(endpoint, {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "text/plain;charset=utf-8" }
      });

      await Swal.fire({
        icon: "success",
        title: "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
        text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö ü•£"
      });

      nameEl.value = "";
      scoopsEl.value = "1";
      updatePrice();
      await loadStatus();
    } catch (e){
      await Swal.fire("‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error");
      await loadStatus();
    }
  }

  scoopsEl.addEventListener("change", updatePrice);

  updatePrice();
  loadStatus();
  setInterval(loadStatus, 20000);
</script>
</body>
</html>
